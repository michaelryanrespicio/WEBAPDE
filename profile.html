<html>
    <head>
        <title>TweetBook</title>
        <link rel="shortcut icon" href="logo.png"/>
        <script src="jquery-3.2.1.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Patrick+Hand+SC" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Tahoma" rel="stylesheet">
        
        <style>
        /* HEADER */
            .page-header{
                height: 80px;
                background-color: forestgreen;
                position: fixed;
                top: 0;
                right: 0;
                left: 0;
                min-width: 800px;
                z-index: 1;
            }
            
            .page-header-container{
                margin-left: 100px;
                margin-top: 5px;
            }
            
            .page-header-container button{
                margin-right: 25px;
            }
            
            #highlight {
                background-color: darkgreen;
                width: 90px;
                height: 80px;
                position: fixed;
                left: 186px;
                top: 0;
                z-index: -1;
            }
            
            #home{    
                background: url('sprites.png') no-repeat -355px -280px;
                width: 72px;
                height: 71px;
                border: none;
            }
            
            #picture{
                background: url('sprites.png') no-repeat -177px -290px;
                width: 76px;
                height: 60px;
                border: none;
            }
            
            #profile{
                background: url('sprites.png') no-repeat -11px -287px;
                width: 61px;
                height: 66px;
                border: none;
            }
            
            #hanap{
                margin-right: 50px;
                margin-top: 20px;
                height: 35px;
                width: 250px;
                border-radius: 10px;
            }
            
            #search-button{
                background: url('sprites.png') no-repeat -104px -296px;
                width: 44px;
                height: 44px;
                border: none;
                margin-top: 15px;
                margin-right: 10px;
                
                
            }
        </style>
        
        <style type="text/css">
            .divider{
                height: 10%;
            }
            
            .body-container{
                position: relative;
            }
            
            .body-header{
                position: relative;
                height: 150px;
                top: 10px;
                width: 100%;
                border-top: 1px dashed forestgreen;
                border-bottom: .5px solid forestgreen;
            }
            
            #profile-name{
                position: relative;
                top: 60px;
                margin-left: 40px;
                font-size: 75px;
                font-family: Patrick Hand SC;
                color: forestgreen;
            }
            
            #profile-username{
                position: relative;
                top: 60px;
                font-size: 20px;
                font-family: Tahoma;
            }
            .profile-mp-container{
                margin-top: 20px;
                width: 100%;
                position: absolute;
            }
            
            .profile-menu{
                position: relative;
                width: 25%;
                float: left;
            }
            
            .profile-posts-container{
                position: relative;
                width: 70%;
                float: right;
                right: 0;
                border-left: 10px solid darkgreen;
            	border-right: 10px solid darkgreen;
            }
            
            .profile-album-container{
                position: relative;
                width: 70%;
                background-color: aquamarine;
                float: right;
                right: 0;
                border-left: 10px solid darkgreen;
            	border-right: 10px solid darkgreen;
                display: hide;
            }
            
            .post-by-user{  
                font-size: small;
                font-family: arial, sans-serif;
                line-height: 1.2;
                text-align: left;
            }
            
             a{
                text-decoration: none;
                font-style: normal;
                color: seagreen;
            }
            
            .post{
                margin-top: 5px;
                margin-bottom: 1px;    
                margin-left: 10px;
                
            }
            
            .post-info{
                font-size: 14px;
                line-height: 20px;
                font-family: sans-serif;
                color: darkslategray;
            }
            
            .post-container{
                border-bottom: 1px solid #e6ecf0;
                border-top: 1px solid #e6ecf0;
                width: 100%;
                display: grid;
                flex-direction: row;
                align-items: center;
            }
            
            .album-container {
                border-bottom: 1px solid #e6ecf0;
                border-top: 1px solid #e6ecf0;
                position: relative;
                margin: 0 auto;
                padding-bottom: 20px;
                width: 95%;
                display: grid;
                flex-direction: row;
                align-items: center;
            }
            
            .photos-container {
                position: relative;
                margin: 0 auto;
                width: 95%;
                padding: 20px;
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
            }
            
            .album-pic {
                margin: 0 auto;
            }
            
            .photo-pic {
                margin-bottom: 15px;
            }
            
            .title{
            	color: darkgreen;
				font-size: 40px;
				font-family: Patrick Hand SC;
            }
            
            .thumbnail {
                width: 150px;
                height: 150px;
            }
            
            .thumbnail:hover {
                cursor: pointer;
            }
            
             .thumbnail img {
                width: 150px;
                height: 150px;
            }
            
            
            .post-div{
				padding: 20px;
				width: 95%;
				left: 10px;
				font-family: Source Sans Pro;
                margin-top: 0%;
            }
            
            .album-div{
				padding: 20px;
				width: 95%;
				left: 10px;
				font-family: Source Sans Pro;
                margin-top: 0%;
            }

             .more{
            	font-family: sans-serif;
                font-size: 12px;
            	position: relative;
                width: 100px;
                margin: auto;
                margin-top: 10px;
                margin-bottom: 10px;
            }
            
            .more:hover{
                color: green;
                text-decoration: underline;

            }
            
            .about{
                position: relative;
                height: 500px;
                padding-top: 15px;
                border: 2px solid darkgreen;
                border-radius: 20px;
                
            }
            
            p {
                font-family: sans-serif;
                color: darkslategray;
                position: relative;
                left: 10px; 
            }
            
            p.indent {
                left: 20px; 
            }
            
            body{
                height: 99%;
                background-color: #bdd4b4;
            }
        </style>
        
        <style>
            #photo {
                background-color: white;
                position: relative;
                width: 600px;
                height: 600px;
                align-self: center;
                margin: auto;
            }
            
            #photo img {
                width: 600px;
                height: 600px;
            }
            
            #modal-bg {
                background-color: rgba(0,0,0,0.7);
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: 1;
                display: none;
                align-content: center;
            }
            
            .top {
                top: 0px;
                height: 60px;
            }
            
            .bot {
                position: absolute;
                height: 40px;
                bottom: 0px;
            }
            
            .photo-info-bg {
                background-color: rgba(0,0,0,0.8);
                width: 100%;
                display: none;
            }
            
            #title {
                position: relative;
                top: 20px;
                left: 20px;
                font-size: 1.2em;
                font-weight: bold;
                font-family: sans-serif;
                color: white;
            }
            
            #album {
                position: relative;
                top: 12px;
                left: 20px;
                font-size: 1.5e,;
                font-family: sans-serif;
                color: white;
            }
            
            #username {
                position: relative;
                top: 12px;
                float: right;
                right: 20px;
                font-size: 1.5e,;
                font-family: sans-serif;
                color: white;
            }
            
            #close {
                position: relative;
                float: right;
                right: 10px;
                font-size: 2.2em;
                color: white;
            }
            
            .clickable:hover,
            .clickable:focus {
                cursor: pointer;
            }
        </style>
        
        <style>
            #post-button{
                background: url('sprites.png') no-repeat -345px -223px;
                width: 70px;
                height: 50px;
                position: fixed;
                right: 0;
                top: 100px;
                border-bottom-left-radius: 10px;
                border-top-left-radius: 10px;
                background-color: palegreen;
                border-color: darkseagreen;
                z-index: 1;
            }
            
            #album-button{
                background: url('sprites.png') no-repeat -280px -220px;
                width: 70px;
                height: 50px;
                position: fixed;
                right: 0;
                top: 160px;
                border-bottom-left-radius: 10px;
                border-top-left-radius: 10px;
                background-color: palegreen;
                border-color: darkseagreen;
                z-index: 1;
            }
        
        </style>
        <style>
            #footer {
                width: 100%;
                height: 30px;
                position: absolute;
                bottom: -50px;
            }
            
            #logo-footer{
                background: url('sprites.png') no-repeat -209px -4px;
                width: 207px;
                height: 40px;
                position: fixed;
                bottom: 10px;
                right: 5px;
            }
        </style>
     
    </head>
    
    <body>
        
        <div class="page-header">
            <div class="page-header-container">
                <a href="mptry2.html"><button id="home"> </button></a>
                <div id="highlight"></div>
                <a href="profile.html?userId=1"><button id="profile"></button></a>
                <a href="photopage.html"><button id="picture"></button></a>
                <div style="float: right">
                    <form style="float:right">
                        <input id="hanap" type="text">
                    </form>
                    <button id="search-button"></button>
                </div>    
            </div>
        </div>
        <div class="divider"></div>
        <div class="body-container">
            <div class="body-header">
                <span id="profile-name">Name</span>
                <span id="profile-username">(Username)</span>
            </div>
            <div class="profile-mp-container">
                <div class="profile-menu">
                    <div class="about">
                    </div>
                </div>
                <div class="profile-album-container">
                    <div class="album-div">
                        
                    </div>
                    <div id="more-album" class="more"> See more albums...</div>
                </div>
                <div class="profile-posts-container">
                    <div class="post-div">
                        
                    </div>
                    <div id="more-post" class="more"> See more posts...</div>
                </div>
                <div id="footer"></div>
            </div>
        </div>
        
        <div id="logo-footer"></div>
        <div>
            <button id="post-button"></button>
            <button id="album-button"></button>
        </div>
        
        <div id="modal-bg">
            <div id="photo">
                <div class="photo-info-bg top">
                    <span id="title">Title</span>
                    <span id="close" class="clickable">&times</span>
                </div>
                <div class="photo-info-bg bot">
                    <span id="album" class="clickable">From Album</span>
                    <span id="username" class="clickable">username</span>
                </div>
            </div>
        </div>
        
        <script>
            const URL = 'https://jsonplaceholder.typicode.com';
            const BY = 5;
            var u_id, a_id = null;
            var posts, user, photos, albums;
            var lastPost, lastAlbum;
            
            function getPosts(){
                return $.ajax({
                    url: URL + '/posts?userId=' + (u_id+1),
                    method: 'GET'
                }).then(function(data){
                    posts = data;
                    lastPost = posts.length-1;
                });
            }
            
            function getUser(){
                return $.ajax({
                    url: URL + '/users?id=' + (u_id+1),
                    method: 'GET'
                }).then(function(data){
                    user = data[0];
                });
            }
            
            function getPhotos(){
                str ='';
                for (var i = 0 ; i < albums.length ; i++)
                    str += '&albumId=' + albums[i].id;
                
                return $.ajax({
                    url: URL + '/photos?' + str,
                    method: 'GET'
                }).then(function(data){
                    photos = data;
                });
            }
            
            function getAlbums(){
                return $.ajax({
                    url: URL + '/albums?userId=' + (u_id+1),
                    method: 'GET'
                }).then(function(data){
                    albums = data;
                    lastAlbum = albums.length-1;
                    /*if (lastAlbum > BY)
                    a_id = albums[lastAlbum-]*/
                });
            }
            
            function loadPhotosToAlbums(){
                var photoscpy = photos.slice();
                
                for (var i = 0 ; i < albums.length ; i++) {
                    albums[i].photos = [];
                    for (var j = photoscpy.length-1 ; j >= 0 ; j--) {
                        if (albums[i].id == photoscpy[j].albumId) {
                            albums[i].photos.push(photoscpy[j]);
                            photoscpy.splice(j,1);
                        }
                    }
                }
            }
            
            function loadHeader() {
                $("#profile-name").text(user.name);
                $("#profile-username").text("(" + user.username + ")");
            }
            
            function loadAbout(){
                var p = document.createElement("p");
                $(p).text("email: " + user.email);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).text("address:");
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text(user.address.street);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text(user.address.suite);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text(user.address.city);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text(user.address.zipcode);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).text("phone: " + user.phone);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).text("website: " + user.website);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).text("company:");
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text("name: " + user.company.name);
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text('"' + user.company.catchPhrase + '"');
                $(".about").append(p);
                
                p = document.createElement("p");
                $(p).addClass("indent");
                $(p).text("business: " + user.company.bs);
                $(".about").append(p);
            }
            
            function loadNextPosts(num) {
                for (var i = lastPost ; i >= lastPost-(num-1) && i >= 0; i--) {
                    addPost(i);
                    if (i == 0) {
                        lastPost = -1;
                        $("#more-post").hide();
                    }
                }
                lastPost = i;
            }
            
            function loadUntilAlbum() {
                for (var i = lastAlbum ; albums[i].id >= a_id+1 ; i--)
                    addAlbum(i);
                lastAlbum = i;
            }
            
            function loadNextAlbums(num) {
              for (var i = lastAlbum ; i >= lastAlbum-(num-1) && i >= 0; i--) {
                    addAlbum(i);
                    if (i == 0) 
                        $("#more-album").hide();
              }
              lastAlbum = i;
            }
            
            function addPost(num) {
               var pc = document.createElement("div");
               var p = document.createElement("div");
               var pbu = document.createElement("div");
               var title = document.createElement("strong");
               var uname = document.createElement("a");
               var inf = document.createElement("div");
                
               $(pc).addClass("post-container");
               $(p).addClass("post");
               $(pbu).addClass("post-by-user");
               $(title).addClass("title");
               $(uname).addClass("username");
               $(inf).addClass("post-info");
                
                $(title).text(posts[num].title);
                uname.innerHTML = "<b>" + user.username + "</b>";
                $(uname).attr('href', document.URL);
                $(inf).text(posts[num].body);
                
                $(pbu).append(title);
                $(pbu).append(document.createElement("br"));
                $(pbu).append(uname);
                $(pbu).append(inf);
                $(p).append(pbu);
                $(pc).append(p);
                
                $(".post-div").append(pc);
            }
            
            function addAlbum(num) {
                var ac = document.createElement("div");
                var ah = document.createElement("div");
                var title = document.createElement("strong");
                var tn = document.createElement("div");
                var img = document.createElement("img");
                
                $(ac).addClass("album-container");
                if (a_id != null && albums[num].id == a_id+1)
                    $(ac).attr("id", "scroll");
                $(title).addClass("title");
                $(tn).addClass("thumbnail");
                $(tn).addClass("album-pic");
                
                var al = albums[num];
                var ph = al.photos[al.photos.length-1];
                
                $(title).text(albums[num].title);
                $(img).attr("src", ph.thumbnailUrl);
                
                $(ah).append(title);
                $(ah).append(tn);
                $(tn).append(img);
                $(ac).append(ah);
                addPhotos(num, ac);
                $(".album-div").append(ac);
            }
            
            function addPhotos(albumId, container) {
                var album = albums[albumId];
                var pc = document.createElement("div");
                $(pc).addClass("photos-container");
                
                for (var i = album.photos.length-1 ; i >= 0 ; i--) {
                    var tn = document.createElement("div");
                    var img = document.createElement("img");
                    
                    $(tn).addClass("thumbnail");
                    $(tn).addClass("photo-pic");
                    
                    $(tn).attr('data-photoId', i);
                    $(tn).attr('data-albumId', albumId)
                    $(img).attr('src', album.photos[i].thumbnailUrl);
                    
                    $(tn).append(img);
                    $(pc).append(tn);
                }
                
                $(container).append(pc);
                if (a_id == null || album.id != a_id+1)
                    $(pc).hide();
            }
            
            $(document).ready(function(){
                
                var urlStr = document.URL;
                urlStr = urlStr.substr(urlStr.indexOf("?")+1);
                urlStr = urlStr.split("&", 2);
                u_id = urlStr[0].substr(urlStr[0].indexOf("=")+1);
                u_id--;
                if (urlStr.length == 2) {
                    a_id = urlStr[1].substr(urlStr[1].indexOf("=")+1);
                    a_id--;
                }
                
                $.when(getUser(), getPosts()).done(function(){
                    loadHeader();
                    loadAbout();
                    loadNextPosts(BY);
                })
                
                $.when(getAlbums()).done(function(){
                   $.when(getPhotos()).done(function(){
                       loadPhotosToAlbums();
                       
                       if (a_id != null) {
                           
                           loadUntilAlbum();
                           
                            $('html, body').animate({
                               scrollTop: $("#scroll").offset().top - 80}, 500);
    
                       } else loadNextAlbums(BY);
                   });
                });
                
                if (urlStr.length == 2) 
                    showAlbums();
                else showPosts();
                
                $("#more-post").click(function(){
                    loadNextPosts(BY);
                });
                
                $("#more-album").click(function(){
                    loadNextAlbums(BY);
                });
                
                $("#post-button").click(function(){
                    showPosts();
                });
                
                $("#album-button").click(function(){
                    showAlbums();
                });
                
                $(document).on('click', '.album-pic', function(){
                    var pc = $(this).parent().parent().find(".photos-container");
                    $(pc).stop();
                    $(pc).toggle(500);
                });
                
                $(document).on('click', '.photo-pic', function(event){
                    var photoId = event.currentTarget.getAttribute("data-photoId");
                    var albumId = event.currentTarget.getAttribute("data-albumId");
                    var album = albums[albumId];
                    var photo = album.photos[photoId];
                    
                    $("#title").text(photo.title);
                    $("#photo").css("background-image", "url(" + photo.url + ")");
                    $("#album").text(album.title);
                    $("#username").text(user.username);
                    
                    $("#modal-bg").css("display", "flex");
                });
                
                $(document).on("mouseover", "#photo", function(event){
                    $(".photo-info-bg").stop();
                    $(".photo-info-bg").fadeIn(250);
                });

                $(document).on("mouseout", "#photo", function(event){
                    $(".photo-info-bg").stop();
                    $(".photo-info-bg").fadeOut(250);
                });
                
                $("#close").click(function(){
                    $("#modal-bg").css("display", "none");
                });
                
                window.onclick = function(event) {
                    if (event.target == document.getElementById("modal-bg")) {
                        $("#modal-bg").css("display", "none");
                    }
                }
                
                $("#username").click(function(){
                   window.location = document.URL; 
                });
            });
            
            function showPosts() {
                $(".profile-album-container").hide();
                $(".profile-posts-container").show();
            }
            
            function showAlbums() {
                $(".profile-posts-container").hide();
                $(".profile-album-container").show();
            }
        </script>
    </body>
</html>