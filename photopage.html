<html>
    <head>
        <script src="jquery-3.2.1.js"></script>
        <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Patrick+Hand+SC" rel="stylesheet">
        <link rel="shortcut icon" href="logo.png"/>
        <style type="text/css">
            .page-header{
            height: 80px;
            background-color: forestgreen;
            position: fixed;
            top: 0;
            right: 0;
            left: 0;
            min-width: 800px;
            z-index: 1;
            }
            
            .page-header-container{
                margin-left: 100px;
                margin-top: 5px;
            }
            
            .page-header-container button{
                margin-right: 25px;
            }
            
            #highlight {
                background-color: darkgreen;
                width: 100px;
                height: 80px;
                position: fixed;
                left: 278px;
                top: 0;
                z-index: -1;
            }
            
            #home{    
                background: url('sprites.png') no-repeat -355px -280px;
                width: 72px;
                height: 71px;
                border: none;
            }
            
            #picture{
                background: url('sprites.png') no-repeat -177px -290px;
                width: 76px;
                height: 60px;
                border: none;
            }
            
            #profile{
                background: url('sprites.png') no-repeat -11px -287px;
                width: 61px;
                height: 66px;
                border: none;
            }
            
            #hanap{
                margin-right: 50px;
                margin-top: 20px;
                height: 35px;
                width: 250px;
            }
            
            #search-button{
                background: url('sprites.png') no-repeat -104px -296px;
                width: 44px;
                height: 44px;
                border: none;
                margin-top: 15px;
                margin-right: 10px;
                
            }
            
            #container {
                display: flex;
                justify-content: space-around;
                flex-wrap: wrap;
                position: relative;
                top: 70px;
            }
            
            body{
            	background-color: #bdd4b4;
            }
            
            .thumbnail {
                margin: 10px;
                border: 1px solid #888;
                width: 150px;
                height: 150px;
                float: left;
            }
            
            .thumbnail img {
                width: 150px;
                height: 150px;
            }
            
            #photo {
                background-color: white;
                position: relative;
                width: 600px;
                height: 600px;
                align-self: center;
                margin: auto;
            }
            
            #photo img {
                width: 600px;
                height: 600px;
            }
            
            #more{
            	font-family: sans-serif;
                font-size: 12px;
            	position: relative;
                width: 100px;
                top: 120px;
                height: 50px;
                margin: auto;
            }
            
            #more:hover{
                color: green;
                text-decoration: underline;

            }
            
            #modal-bg {
                background-color: rgba(0,0,0,0.7);
                position: fixed;
                width: 100%;
                height: 100%;
                top: 0;
                left: 0;
                z-index: 1;
                display: none;
                align-content: center;
            }
            
            .top {
                top: 0px;
                height: 60px;
            }
            
            .bot {
                position: absolute;
                height: 40px;
                bottom: 0px;
            }
            
            .photo-info-bg {
                background-color: rgba(0,0,0,0.8);
                width: 100%;
                display: none;
            }
            
            #title {
                position: relative;
                top: 20px;
                left: 20px;
                font-size: 1.2em;
                font-weight: bold;
                font-family: sans-serif;
                color: white;
            }
            
            #album {
                position: relative;
                top: 12px;
                left: 20px;
                font-size: 1.5e,;
                font-family: sans-serif;
                color: white;
            }
            
            #username {
                position: relative;
                top: 12px;
                float: right;
                right: 20px;
                font-size: 1.5e,;
                font-family: sans-serif;
                color: white;
            }
            
            #close {
                position: relative;
                float: right;
                right: 10px;
                font-size: 2.2em;
                color: white;
            }
            
            .clickable:hover,
            .clickable:focus {
                cursor: pointer;
            }
            
        </style>
        
        <style>
            #logo-footer{
                background: url('sprites.png') no-repeat -209px -4px;
                width: 207px;
                height: 40px;
                position: fixed;
                bottom: 10px;
                right: 5px;
            }
        </style>
        
    </head>
    
    <body>
        
        <div class="page-header">
            <div class="page-header-container">
                <a href="mptry2.html"><button id="home"> </button></a>
                <a id="profile"><button id="profile"></button></a>
                <div id="highlight"></div>
                <a href="photopage.html"><button id="picture"></button></a>
                
                <div style="float: right">
                    <form style="float:right">
                        <input id="hanap" type="text">
                    </form>
                    <button id="search-button"></button>
                    
                </div>    
            </div>
        </div>
        
        <div id="container">
            
        </div>
        
        <div id="more">See more photos...</div>
        
            <div id="modal-bg">
                <div id="photo">
                    <div class="photo-info-bg top">
                        <span id="title">Title</span>
                        <span id="close" class="clickable">&times</span>
                    </div>
                    <div class="photo-info-bg bot">
                        <span id="album" class="clickable">From Album</span>
                        <span id="username" class="clickable">username</span>
                    </div>
                </div>
            </div>
        
        <div id="logo-footer"></div>
        
        <script>
        const URL = 'https://jsonplaceholder.typicode.com';
        const BY = 15;
        var photos, albums, users, last;
            
        function getPhotos() {
            return $.ajax({
                url: URL + '/photos',
                method: 'GET'
            }).then(function(data){
                photos = data;
                last = photos.length-1;
            })
        }
            
        function getAlbums() {
            return $.ajax({
                url: URL + '/albums',
                method: 'GET'
            }).then(function(data){
               albums = data;
            }); 
        }
        
        function getUsers() {
            return $.ajax({
                url: URL + '/users',
                method: 'GET'
            }).then(function(data){
               users = data;
            }); 
        }    
        
        function loadNext(num) {
            for (var i = last ; i >= last-(num-1) && i >= 0 ; i--) {
                addPic(i);
                if (i == 0) {
                    last = -1;
                    $("#more").hide();
                    break;
                }
            }
        }
            
        function addPic(num) {
          var d = document.createElement("div");
          var img = document.createElement("img");

          $(d).addClass("thumbnail");
            
          $(d).attr("data-photoId", num);
          $(img).attr("src", photos[num].thumbnailUrl);

          $(d).append(img);
          $("#container").append(d);
        }
        
        $(document).ready(function(){
            $("#more").click(function(){
               last -= BY;
               loadNext(BY);
            });
            
            $("#close").click(function(){
                $("#modal-bg").css("display", "none");
            });
            
            $(document).on("click", ".thumbnail", function(event){
                var photoId = event.currentTarget.getAttribute("data-photoId");
                var photoUrl = photos[photoId].url;
                var photoTitle = photos[photoId].title;
                var albumId = photos[photoId].albumId-1;
                var userId = albums[albumId].userId-1;
                
                var albumname = albums[albumId].title;
                var uname = users[userId].username;
                
                $("#title").text(photoTitle);
                $("#photo").css("background-image", "url(" + photoUrl + ")");
                $("#album").text(albumname);
                $("#username").text(uname);
                
                $("#username").click(function(){
                   window.location = 'profile.html?userId=' + (userId+1);
                });
                
                $("#album").click(function(){
                   window.location = 'profile.html?userId=' + (userId+1) + '&albumId=' + (albumId+1);
                })
                
                $("#modal-bg").css("display", "flex");
            });
            
            $(document).on("mouseover", "#photo", function(event){
                $(".photo-info-bg").stop();
                $(".photo-info-bg").fadeIn(250);
            });
            
            $(document).on("mouseout", "#photo", function(event){
                $(".photo-info-bg").stop();
                $(".photo-info-bg").fadeOut(250);
            });
            
            window.onclick = function(event) {
                if (event.target == document.getElementById("modal-bg")) {
                    $("#modal-bg").css("display", "none");
                }
            }
            
            $.when(getPhotos(), getUsers(), getAlbums()).done(function(){
                loadNext(BY);
                $("a#profile").attr('href', 'profile.html?userId=' + albums[photos[photos.length-1].albumId-1].userId);
            });
        });
        
        </script>
    </body>
</html>